/Network/OpenvSwitch/Interface:
  description: "OpenvSwitch: Interface Monitoring"
  targetPythonClass: ZenPacks.zenoss.OpenvSwitch.Interface

  datasources:
    interfaceStatus:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,admin_state,link_state list interface;
      cycletime: 300

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatus
      type: COMMAND
      component: ${here/id}
      usessh: true
      eventClass: "/Net"
      eventKey: "interface_status"
      severity: Error

    interfaceIncomingBytes:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface
      cycletime: 300

      datapoints:
        rx_bytes:
          rrdmin: 0
          aliases:
            incoming_bytes: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    interfaceOutgoingBytes:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface
      cycletime: 300

      datapoints:
        tx_bytes:
          rrdmin: 0
          aliases:
            outgoing_bytes: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    interfaceIncomingPackets:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface
      cycletime: 300

      datapoints:
        rx_packets:
          rrdmin: 0
          aliases:
            incoming_packets: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    interfaceOutgoingPackets:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface
      cycletime: 300

      datapoints:
        tx_packets:
          rrdmin: 0
          aliases:
            outgoing_packets: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    collisions_dropped:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface
      cycletime: 300

      datapoints:
        collisions:
          rrdmin: 0
          aliases:
            collisions: ""

        rx_dropped:
          rrdmin: 0
          aliases:
            incoming_packets_dropped: ""

        tx_dropped:
          rrdmin: 0
          aliases:
            outgoing_packets_dropped: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    errors:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface
      cycletime: 300

      datapoints:
        rx_crc_err:
          rrdmin: 0
          aliases:
            incoming_packets_CRC_error: ""

        rx_errors:
          rrdmin: 0
          aliases:
            incoming_packets_error: ""

        tx_errors:
          rrdmin: 0
          aliases:
            outgoing_packets_error: ""

        rx_frame_err:
          rrdmin: 0
          aliases:
            incoming_frame_error: ""

        rx_over_err:
          rrdmin: 0
          aliases:
            incoming_buffer_overrun_error: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

  graphs:
    Throughput:
      units: bits/sec
      height: 100
      width: 500

      graphpoints:
        Inbound:
          dpName: interfaceIncomingBytes_rx_bytes
          format: '%7.0lf'
        Outbound:
          dpName: interfaceOutgoingBytes_tx_bytes
          format: '%7.0lf'

    Packets:
      units: packets/sec
      height: 100
      width: 500

      graphpoints:
        Inbound:
          dpName: interfaceIncomingPackets_rx_packets
          format: '%7.0lf'
        Outbound:
          dpName: interfaceOutgoingPackets_tx_packets
          format: '%7.0lf'

    Dropped Collisions:
      units: drops/sec
      height: 100
      width: 500

      graphpoints:
        Inbound Drops:
          dpName: collisions_dropped_rx_dropped
          format: '%7.0lf'
        Outbound Drops:
          dpName: collisions_dropped_tx_dropped
          format: '%7.0lf'
        Collision Drops:
          dpName: collisions_dropped_collisions
          format: '%7.0lf'

    Errors:
      units: errors/sec
      height: 100
      width: 500

      graphpoints:
        Inbound Packet Errors:
          dpName: errors_rx_errors
          format: '%7.0lf'
        Outbound Packet Errors:
          dpName: errors_tx_errors
          format: '%7.0lf'
        Inbound Packet CRC Errors:
          dpName: errors_rx_crc_err
          format: '%7.0lf'
        Inbound Frame Errors:
          dpName: errors_rx_frame_err
          format: '%7.0lf'
        Inbound Buffer Overrun Errors:
          dpName: errors_rx_over_err
          format: '%7.0lf'

/Network/OpenvSwitch/Bridge:
  description: "OpenvSwitch: Bridge Monitoring"
  targetPythonClass: ZenPacks.zenoss.OpenvSwitch.Bridge

  datasources:
    openvswitchStatus:
      commandTemplate: /bin/echo 'BEGIN' ; /sbin/service openvswitch status 2> /dev/null ; echo "SPLIT" ; /usr/bin/systemctl status openvswitch.service 2> /dev/null ; echo "SPLIT" ; /usr/bin/sudo service openvswitch-switch status 2> /dev/null ; echo "END"
      cycletime: 300

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.OVSStatus
      type: COMMAND
      usessh: true
      eventClass: "/Service/State/Availability"
      eventKey: "ovs_status"
      severity: Critical

    bridgePortStatus:
      commandTemplate: /usr/bin/sudo /usr/bin/ovsdb-tool show-log;
      cycletime: 300

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.BridgePortStatus
      type: COMMAND
      component: ${here/title/}
      usessh: true
      eventClass: "/Status"
      eventKey: "bridge_port_status"
      severity: Info

    bridgeFlowCount:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=name,_uuid list bridge; for txt in $$(/usr/bin/sudo /usr/bin/ovs-vsctl --columns=name list bridge); do if [ $$txt != 'name' ] && [ $$txt != ':' ] ; then echo $$txt; /usr/bin/sudo /usr/bin/ovs-ofctl dump-aggregate $$txt; fi; done;
      cycletime: 300

      datapoints:
        flow_count:
          rrdmin: 0
          aliases:
            flow_count: ""

        byte_count:
          rrdmin: 0
          aliases:
            byte_count: ""

        packet_count:
          rrdmin: 0
          aliases:
            packet_count: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.BridgeStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

  graphs:
    Flow:
      units: count
      height: 100
      width: 500

      graphpoints:
        Flow:
          dpName: flow_count
          format: '%7.0lf'

    Throughput:
      units: bits/sec
      height: 100
      width: 500

      graphpoints:
        Total bridge throughput:
          dpName: byte_count
          format: '%7.0lf'

    Packets:
      units: packets/sec
      height: 100
      width: 500

      graphpoints:
        Total bridge packets:
          dpName: packet_count
          format: '%7.0lf'
