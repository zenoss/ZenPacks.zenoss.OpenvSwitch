/Network/OpenvSwitch/Interface:
  description: "OpenvSwitch: Interface Monitoring"
  targetPythonClass: ZenPacks.zenoss.OpenvSwitch.Interface

  datasources:
    interfaceStatus:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,admin_state,link_state list interface 2 >&1;
      cycletime: 300

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatus
      type: COMMAND
      component: ${here/id}
      usessh: true
      eventClass: "/Status"
      eventKey: "interface_status"
      severity: Error

    interfaceIncomingByteRate:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface 2 >&1;
      cycletime: 300

      datapoints:
        rx_bytes:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_bytes: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    interfaceOutgoingByteRate:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface 2 >&1;
      cycletime: 300

      datapoints:
        tx_bytes:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            outgoing_bytes: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    interfaceIncomingPacketRate:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface 2 >&1;
      cycletime: 300

      datapoints:
        rx_packets:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_packets: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    interfaceOutgoingPacketRate:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface 2 >&1;
      cycletime: 300

      datapoints:
        tx_packets:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            outgoing_packets: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    collisions_dropped:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface 2 >&1;
      cycletime: 300

      datapoints:
        collisions:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            collisions: ""

        rx_dropped:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_packets_dropped: ""

        tx_dropped:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            outgoing_packets_dropped: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

    errors:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=_uuid,statistics,external_ids,mac_in_use,name list interface 2 >&1;
      cycletime: 300

      datapoints:
        rx_crc_err:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_packets_CRC_error: ""

        rx_errors:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_packets_error: ""

        tx_errors:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            outgoing_packets_error: ""

        rx_frame_err:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_frame_error: ""

        rx_over_err:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            incoming_buffer_overrun_error: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.InterfaceStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

  graphs:
    Throughput:
      units: bits/sec
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Inbound:
          dpName: interfaceIncomingByteRate_rx_bytes
          format: '%7.2lf%s'
        Outbound:
          dpName: interfaceOutgoingByteRate_tx_bytes
          format: '%7.2lf%s'

    Packets:
      units: packets/sec
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Inbound:
          dpName: interfaceIncomingPacketRate_rx_packets
          format: '%7.2lf%s'
        Outbound:
          dpName: interfaceOutgoingPacketRate_tx_packets
          format: '%7.2lf%s'

    Dropped Collisions:
      units: drops/sec
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Inbound Drops:
          dpName: collisions_dropped_rx_dropped
          format: '%7.2lf%s'
        Outbound Drops:
          dpName: collisions_dropped_tx_dropped
          format: '%7.2lf%s'
        Collision Drops:
          dpName: collisions_dropped_collisions
          format: '%7.2lf%s'

    Errors:
      units: errors/sec
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Inbound Packet Errors:
          dpName: errors_rx_errors
          format: '%7.2lf%s'
        Outbound Packet Errors:
          dpName: errors_tx_errors
          format: '%7.2lf%s'
        Inbound Packet CRC Errors:
          dpName: errors_rx_crc_err
          format: '%7.2lf%s'
        Inbound Frame Errors:
          dpName: errors_rx_frame_err
          format: '%7.2lf%s'
        Inbound Buffer Overrun Errors:
          dpName: errors_rx_over_err
          format: '%7.2lf%s'

/Network/OpenvSwitch/Bridge:
  description: "OpenvSwitch: Bridge Monitoring"
  targetPythonClass: ZenPacks.zenoss.OpenvSwitch.Bridge

  datasources:
    openvswitchStatus:
      commandTemplate: /bin/echo 'BEGIN' 2> /dev/null ; /sbin/service openvswitch status 2>&1; echo "SPLIT" ; /usr/bin/systemctl status openvswitch-nonetwork.service 2>&1; echo "SPLIT" ; /usr/bin/sudo service openvswitch-switch status 2>&1; echo "END"
      cycletime: 300

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.OVSStatus
      type: COMMAND
      usessh: true
      eventClass: "/Status"
      eventKey: "ovs_status"
      severity: Critical

    bridgePortStatus:
      commandTemplate: /bin/date -u +%s 2> /dev/null ; echo "SPLIT" ; /usr/bin/ovs-vsctl list bridge 2>&1; echo "SPLIT" ; /usr/bin/sudo /usr/bin/ovsdb-tool show-log;
      cycletime: 300

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.BridgePortStatus
      type: COMMAND
      component: ${here/title}
      usessh: true
      eventClass: "/Status"
      eventKey: "bridge_port_status"
      severity: Info

    bridgeFlowCount:
      commandTemplate: /usr/bin/sudo /usr/bin/ovs-vsctl --columns=name,_uuid list bridge 2>&1; for txt in $$(/usr/bin/sudo /usr/bin/ovs-vsctl --columns=name list bridge 2>&1); do if [ $$txt != 'name' ] && [ $$txt != ':' ] ; then txt=$$(echo $$txt | tr -d \'\"\' ); echo $$txt; /usr/bin/sudo /usr/bin/ovs-ofctl dump-aggregate $$txt 2>&1; fi; done;
      cycletime: 300

      datapoints:
        flow_count:
          rrdmin: 0
          aliases:
            flow_count: ""

        byte_count:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            byte_count: ""

        packet_count:
          rrdmin: 0
          rrdtype: DERIVE
          aliases:
            packet_count: ""

      parser: ZenPacks.zenoss.OpenvSwitch.parsers.BridgeStatistics
      type: COMMAND
      component: ${here/id}
      usessh: true

  graphs:
    Flow:
      units: count
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Flow count:
          dpName: bridgeFlowCount_flow_count
          format: '%7.0lf'

    Throughput:
      units: bits/sec
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Bridge throughput:
          dpName: bridgeFlowCount_byte_count
          format: '%7.2lf%s'

    Packets:
      units: packets/sec
      height: 100
      width: 500
      miny: 0

      graphpoints:
        Bridge packet rate:
          dpName: bridgeFlowCount_packet_count
          format: '%7.2lf%s'
